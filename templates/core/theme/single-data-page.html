{% load static i18n %}<html lang="en">
<head>
<title>Email Template</title>
<meta charset="UTF-8">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
<link rel="stylesheet" type="text/css" href="{% static 'css/theme/styles.css' %}?v={{CACHE_VERSION}}">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
{% comment %} <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script> {% endcomment %}
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx" crossorigin="anonymous"></script>

    <script src="//cdn.datatables.net/1.10.7/js/jquery.dataTables.min.js"></script>
    <script src="{% static 'js/theme/dataTable.js' %}" ></script>
    <script src="{% static 'js/theme/dataTables.responsive.min.js' %}" ></script>
    <link rel="stylesheet" type="text/css" href="{% static 'css/theme/jquery.dataTables.min.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'css/theme/responsive.dataTables.min.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'css/datatable.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'css/responsive.css' %}">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="{% static 'js/theme/custom.js' %}?v={{CACHE_VERSION}}" ></script>
 <style>
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap');
   
body
{
    background-color: #eeeeee;
    font-family: "Nunito Sans", sans-serif;
}
    .header {
    background-color: #fff;
    box-shadow: 0 0 10px rgb(0 0 0 / 10%);
    padding: 15px 15px 10px 15px;
    }
    .header .logo {
        width: 100%;
        text-align: center;
    }
    .header .logo img {
        max-width: 260px;
    }
    .data {
    width: 100%;
    padding: 20px;
}
.data .inside {
    background-color: #fff;
    box-shadow: 0 0 20px rgb(0 0 0 / 10%);
    padding: 15px 15px 30px;
    border-radius: 5px;
    max-width: 1500px;
    margin: 0 auto;
}
.data .title {
    display: flex;
    justify-content: space-between;
    align-items: center;
    display: -webkit-flex;
    -webkit-justify-content: space-between;
    -webkit-align-items: center;
    margin-bottom: 15px;
}
.data .title h2 {
    font-size: 22px;
    font-weight: 600;
    margin: 0;
}
.data .title a {
    color: #fff!important;
    box-shadow: 3px 10px 10px #67c5bd59;
    border-radius: 30px;
    font-size: 15px;
    line-height: 18px;
    padding: 13px 20px;
    background-image: linear-gradient(to bottom, #67c5bd, #5bbcb4, #4fb3aa, #42aaa1, #34a198);
    display: inline-block;
    text-decoration: none;
}
.cust-responsive.global_table table.dataTable.table_design tbody tr td, .cust-responsive.global_table table.dataTable.table_design thead tr th
{
    height: 56px;
}
.cust-responsive.global_table .dataTables_filter
{
    margin-right: 0;
}
.dropdown.dropdown-cust.open .dropdown-menu.dropdown-menu-right {
    display: block;
    left: 0;
}
tbody#partbl2 .dropdown {
    text-align: left;
}
    table.client-actual-table tbody#partbl2 tr.extended-html td 
    {
        padding: 10px;
    display: inline-block;
    vertical-align: middle;
    position: relative;
    word-break: break-word;
    font-size: 14px;
    line-height: 18px;
    width: 16.4%;
}
table.client-actual-table button#dropdownMenuButton {
    padding: 12px 0;
}
table.client-actual-table .dropdown.dropdown-cust {
    text-align: left;
}
.data .dropdown {
    position: relative;
}

</style>
</head>
<body>

    <header class="header">
        <div class="logo"><img src="http://leadershiprealitycheck.com/static/images/theme/logo.png"></div>
    </header>

    <section class="data wizard-wrap">
        <div class="inside">
            <div class="title">
                <h2>All Participants</h2>
                <a class="add_participant open-popup-addparticipant" data-toggle="modal" data-target="#participants">
                                                    + Add Participants
                                                </a>
            </div>
            <div class="row">
                <div class="col-12 col-md-12">
                       <div class="cust-responsive global_table ">                               
                         <table class="table table_design add-participant-table " id="my-add-participant-table">
                     
                         <thead>
                            <tr>                              
                               <th>No.</th>
                               <th>First Name</th>
                               <th>Last Name</th>
                               <th>Email</th>
                               <th>Relationship</th>
                               <th>Action</th>
                            </tr>
                         </thead>
                        <tbody id="partbl">                           
                         </tbody> 
                      </table>
                   </div>
                </div>
        
        </div>
    </section>


<div class="modal fade" id="edit-part" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
        <div class="modal-content">
          <div class="modal-header">
              <h3 class="text-dark font-weight-bold">Edit Participant</h3>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
              <div class="addmodal">
                <!--form-->
                    <div class="add_partici_wrp">

                        <div class="client_intake_form mt-3">
                            <form name="editparticipantfrm" class="commnewfrmdesign" id="editparticipantfrm" method="post" >
        
                                {% csrf_token %}
                                <div class="add_participant_data overflow-auto col-sm-12 h-auto ">
                                    <div class="d-block client-info mb-0 mb-lg-0" id="block-1">
                                        <div class="row mt-2 mt-lg-4">
                                        <div class="col-12 col-md-6 col-lg-6">
                                            <div class="form-group">
                                                <div class="input-group cst-input-group mb-3">
                                                    <div class="input-group-prepend"><span class="input-group-text" id="basic-addon1"><i class="mdi mdi-account-outline"></i></span></div>
                                                    <input type="text" name="fname" class="form-control cutome-input"  id="efname" placeholder="First Name">
                                                    <span class="error" id="fnameerr"></span>
                                                </div>
                                            </div>
                                        </div>
        
                                        <div class="col-12 col-md-6 col-lg-6">
                                            <div class="form-group">
                                                <div class="input-group cst-input-group mb-3">
                                                    <div class="input-group-prepend"><span class="input-group-text" id="basic-addon1"><i class="mdi mdi-account-outline"></i></span></div>
                                                    <input type="text" name="lname" class="form-control cutome-input" id="elname" placeholder="Last Name">
                                                    <span class="error" id="lnameerr"></span>
                                                </div>
                                            </div>
                                        </div>
        
                                        <div class="col-12 col-md-6 col-lg-6">
                                            <div class="form-group">
                                                <div class="input-group cst-input-group mb-3">
                                                    <div class="input-group-prepend"><span class="input-group-text" id="basic-addon1"><i class="mdi mdi-account-outline"></i></span></div>
                                                    <input type="email" name="email" class="form-control cutome-input" id="eemail" placeholder="Email">
                                                    <span class="error" id="eemailerr"></span>
                                                </div>
                                            </div>
                                        </div>
        
                                        <div class="col-12 col-md-6 col-lg-6">
                                            <div class="form-group">
                                                <div class="input-group cst-input-group mb-3">
                                                    <div class="input-group-prepend"><span class="input-group-text" id="basic-addon1"><i class="mdi mdi-account-outline"></i></span></div>
                                                    <select name="relationship"  class="form-control cutome-input" id="erelationship">
                                                        <option value="demo">Select Relationship</option>
                                                        {% for r in relation %}
                                                        <option value={{ r.id }}>{{ r.relation }}</option>
                                                        {% endfor %}
                                                    </select>
                                                    <span class="error" id="relationshiperr"></span>
                                                </div>                                               
                                            </div>
                                        </div>
                                    </div>
                                        <div class="col-md-12 alignright savecanquestbtnwrp" >
                                        </div>
                                    </div>
                                </div>
                                <div class="sub_field mt-0 mb-3">
                                    <a class="savequestbtn sitebtn m-0" id="edit" data-toggle="modal" >Save</a>
                                </div>
                            </form>
                        </div>

                    </div>
                <!--form-end-->
                </div>
                <div class="modal-footer pt-1 pb-1" >
                    <div class="sub_field">
                        <a class="savequestbtn sitebtn" data-dismiss="modal"> Cancel</a></a>
                    </div>
                </div>
              </div>
            </div>
    </div>
    </div>

<!--Add-Participants -->


<div class="modal fade pl-0" id="participants" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-xl" role="document">
       <div class="modal-content">
          <div class="modal-header">
             <h3 class="text-dark font-weight-bold">Add Participants</h3>
             <button type="button" class="close" data-dismiss="modal" aria-label="Close">
             <span aria-hidden="true">&times;</span>
             </button>
          </div>
          <div class="modal-body">
             <div class="addmodal">
                <!--form-->
                <div class="add_partici_wrp">
                   <p>Enter each participant who would be providing feedback.</p>
                   <div class="client_intake_form mt-3">
                      <form name="addparticipantfrm" class="commnewfrmdesign" id="addparticipantfrm" method="post" >
                         {% csrf_token %}
                         <div class="add_participant_data overflow-auto col-sm-12 h-auto ">
                            <div class="d-block client-info mb-0 mb-lg-0" id="block-1">
                               <div class="row mt-2 mt-lg-4">
                                  <div class="col-12 col-md-6 col-lg-6">
                                     <div class="form-group">
                                        <div class="input-group cst-input-group mb-3">
                                            <div class="input-group-prepend"><span class="input-group-text" id="basic-addon1"><i class="mdi mdi-account-outline"></i></span></div>
                                            <input type="text" name="fname" onkeydown="return /[a-z]/i.test(event.key)" class="form-control cutome-input"  id="fname1" placeholder="First Name">
                                            <span class="error" id="fnameerr1"></span>
                                        </div>
                                     </div>
                                  </div>
                                  <div class="col-12 col-md-6 col-lg-6">
                                     <div class="form-group">
                                        <div class="input-group cst-input-group mb-3">
                                            <div class="input-group-prepend"><span class="input-group-text" id="basic-addon1"><i class="mdi mdi-account-outline"></i></span></div>
                                            <input type="text" name="lname" onkeydown="return /[a-z]/i.test(event.key)" class="form-control cutome-input" id="lname1" placeholder="Last Name">
                                            <span class="error" id="lnameerr1"></span>
                                        </div>
                                     </div>
                                  </div>
                                  <div class="col-12 col-md-6 col-lg-6">
                                     <div class="form-group">
                                        <div class="input-group cst-input-group mb-3">
                                            <div class="input-group-prepend"><span class="input-group-text" id="basic-addon1"><i class="mdi mdi-account-outline"></i></span></div>
                                            <input type="email" name="email" class="form-control cutome-input" id="email1" placeholder="Email">
                                            <span class="error" id="emailerr1"></span>
                                        </div>
                                     </div>
                                  </div>
                                  <div class="col-12 col-md-6 col-lg-6">
                                     <div class="form-group">
                                        <div class="input-group cst-input-group mb-3">
                                            <div class="input-group-prepend"><span class="input-group-text" id="basic-addon1"><i class="mdi mdi-account-outline"></i></span></div>
                                            <select name="relationship"  class="form-control cutome-input" id="relationship1">
                                                <option value="demo" selected>Select Relationship</option>
                                                {% for r in relation %}
                                                <option value={{ r.id }}>{{ r.relation }}</option>
                                                {% endfor %}
                                            </select>
                                            <span class="error" id="relationshiperr1"></span>
                                        </div>
                                        <!-- <div class="cmn_field forgot_pass checkbox_cmnwrp mt-3 participant_check">
                                           <label class="text-black"><input type="checkbox" name="forgtpass"> Enter Relation</label>
                                           </div> -->
                                     </div>
                                  </div>
                               </div>
                               <div class="col-md-12 alignright savecanquestbtnwrp" >
                               </div>
                            </div>
                         </div>
                         <div class="sub_field mt-0 mb-3">
                            <a class="savequestbtn sitebtn m-0" id="savepart" data-toggle="modal">Add</a>
                         </div>
                         <input type="hidden" id="link" value="{{linkobj.code}}">
                         <input type="hidden" id="participant_id">
                      </form>
                      <div class="row mt-2 mt-lg-4">
                         <div class="col-12 col-md-12">
                            <div class="cust-responsive global_table all-doc">
                               <table class="table table_design mt-0" id="myTable2">
                                  <thead>
                                     <tr>
                                        <th>No.</th>
                                        <th>First Name</th>
                                        <th>Last Name</th>
                                        <th>Email</th>
                                        <th>Relationship</th>
                                     </tr>
                                  </thead>
                                  <tbody>
                                  </tbody>
                               </table>
                            </div>
                         </div>
                      </div>
                   </div>
                </div>
             </div>
          </div>
          <div class="modal-footer mt-2 pt-1 pb-1">
             <div class="sub_field">
                <a class="savequestbtn sitebtn" data-dismiss="modal"> Save</a></a>
                <a class="savequestbtn sitebtn" data-dismiss="modal"> Cancel</a></a>
             </div>
          </div>
       </div>
    </div>
 </div>
 </div>

 
<input id="datalist" value="{{participantlist}}" hidden>


<div class="delete_cnfm_popup cmn_sitepopup" id="del_particip">
    <div class="delete_cnfm_inn cmn_site_inn_popup">
       <a href="javascript:;" class="closepoup" data-dismiss="modal"></a>
       <div class="cmn_sitepopup_scroll">
          <h2>Are you sure you want to delete Participant?</h2>
          <div class="d-flex justify-content-center">
             <button type="button" class="sitebtn mr-3 pl-5 pr-5" id="delete_participant">Yes</button>
             <button type="button" class="sitebtn ml-3 pl-5 pr-5 closepoup" data-dismiss="modal">No</button>
          </div>
       </div>
    </div>
    <div class="whiteoverlay"></div>
 </div> 

<script>
    var code = document.getElementById('link').value;
    $(document).ready( function () {
       var t = $('#my-add-participant-table').DataTable({
            "ordering": false,
            responsive: true,   
            serverSide: true,
            searching: false,
            "processing": true,
            oLanguage: {sProcessing: '<i class="fa fa-spinner fa-spin fa-3x fa-fw"></i><span class="sr-only">Loading...</span>'},
            
            ajax: window.location.origin + "/participantdt/"+ code ,
            rowId: "id",
            columns: [
            { 
                "data": "id", 
                render: function(data, type, full, meta) {
                    return meta.row + meta.settings._iDisplayStart + 1;
                }
            },
            { "data": "first_name" },
            { "data": "last_name"},
            { "data": "email" },
            { "data": "relationship"},
            { 
                "data": "id", 
                "render": function(data) { 
                    link = document.location.origin+'/survey/show_survey/'+data                      
                    return '<div class="dropdown dropdown-cust"><button class="btn dropdown-toggle no-arrow" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><i class="fa fa-ellipsis-v dots-icon" aria-hidden="true"></i></button><div class="dropdown-menu dropdown-menu-right" aria-labelledby="dropdownMenuButton"><a class="dropdown-item edit_value" data-toggle="modal" data-id="'+data+'" data-target="#edit-part">Edit</a><a class="dropdown-item" onclick="deletepart('+data+')">Delete</a></div></div>'
                 }
            }],
        });
        jQuery('#fname1').focusout(function () {
            var fname = jQuery(this).val();
            if(fname == "" || fname == null) {
            jQuery('#fnameerr1').text('Please enter first name');
        } else {
            jQuery('#fnameerr1').text('');
        }
        });

        jQuery('#lname1').focusout(function () {
            var lname = jQuery(this).val();
            if(lname == "" || lname == null) {
            jQuery('#lnameerr1').text('Please enter last name');
        } else {
            jQuery('#lnameerr1').text('');
        }
        });

        jQuery('#email1').focusout(function () {
        var email = jQuery(this).val();
		if(email == "" || email == null) {
			jQuery('#emailerr1').text('Please enter email address');
		} else {
			var re = /[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,4}/igm;
			if (re.test(email)) {
				jQuery('#emailerr1').text('');
			} else {
				jQuery('#emailerr1').text('Please enter a valid email address');
			}	
        
        }
        });

        jQuery('#relationship1').focusout(function () {
            var relationship = jQuery(this).val();
            if(relationship == "" || relationship == null || relationship == "demo")  {
            jQuery('#relationshiperr1').text('Please select any one relationship');
        } else {
            jQuery('#relationshiperr1').text('');
        }
        });
               
    $('body').on('click', '#savepart', function(e) {
        e.preventDefault();
        var data = {};
        token = document.getElementsByName("csrfmiddlewaretoken")[0].value;
        client_id = window.location.href.split("code")[1];
        href_code = window.location.href.split("/client_data_view/")[1];


        if ($('#relationship1').val() != 'demo' && $('#email1').val() != '' && $('#lname1').val() != '' && $('#fname1').val() != ''){        
            
        try {
            var fn = document.getElementById('fname1').value;
            var ln = document.getElementById('lname1').value;
            var em = document.getElementById('email1').value;
            var rl = document.getElementById('relationship1').value;
            //var code = document.getElementById('link').value;
            data["fname"]= fn;
            data["lname"]= ln;
            data["email"]= em;
            data["rel"]= rl;
            data["id"]= client_id;
            data["code"]= href_code;
            }
        catch(err) {
            console.log('error')
        } ;         
            $.ajax({
                    type: "POST",
                    url: "{% url 'congo' %}",
                    data: {'data': data},
                    headers: {'X-CSRFToken': token },
                    success: function (data) {
                    if (data['error']){
                        $('#emailerr1').text(data['error']);
                    } 
                    else {
                        $('#my-add-participant-table').DataTable().ajax.reload(); 
                        $('#myTable2').DataTable().ajax.reload(); 
                        $('#participants input').val('');
                        $("#participants select").val('demo');
                        }
                    },
                    error: function(data) {
                        console.log(data)
                    }
                });



        }
        }); 


    
    } );
   
    function deletepart(id) {
        $('a.view').css("pointer-events", "none");
       
        cid = window.location.href.split("code")[1]
        token = document.getElementsByName("csrfmiddlewaretoken")[0].value
        $.ajax({
            url: '{% url "congo" %}',
            type: "DELETE",
            data: {'id': id, 'cid':cid},
            headers: {'X-CSRFToken': token },
            success: function(data) {
                $('#my-add-participant-table').DataTable().ajax.reload();      
            }
        })
    };

   
var list = $('#datalist').val()
    {% comment %} $(document).ready(function(){
        $(".add_participant").click(function(){
            $('#participants').fadeIn();
        });
        $(".modal .close").click(function(){
            $('#participants').fadeOut();
        });
    }); {% endcomment %}

</script>

<script src="{% static 'js/bootstrap.min.js' %}"></script>


<!--script for editing data-->
<script>
    $('body').on('click', '#edit', function() {        
        token = document.getElementsByName("csrfmiddlewaretoken")[0].value
        var data = {};
        client_id = window.location.href.split("code")[1]
        var email = document.getElementById('eemail').value;
        if(email == "" || email == null) {
                jQuery('#eemailerr').text('Please enter a email address');
            } else {
                var re = /[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,4}/igm;
                if (re.test(email)) {
                    jQuery('#eemailerr').text('');
                token = document.getElementsByName("csrfmiddlewaretoken")[0].value
                var data = {};
                try {
                    var fn = document.getElementById('efname').value;
                    var ln = document.getElementById('elname').value;           
                    var rl = document.getElementById('erelationship').value;
                    var id = document.getElementById('participant_id').value;
                    data["fname"]= fn;
                    data["lname"]= ln;
                    data["email"]= email;
                    data["rel"]= rl;
                    data["id"]= client_id;
                    data['participant_id']=id
                    }
                catch(err) {
                    console.log('error')
                }
                try {
                    $.ajax({
                            type: "PUT",
                            url: "{% url 'congo' %}",
                            data: JSON.stringify(data),
                            headers: {'X-CSRFToken': token },
                            success: function (data) {
                                if (data['fail'] == 'fail') {
                                    jQuery('#eemailerr').text('Email already exists.');
                                 } 
                                 else{
                                    $('#edit-part').modal('hide');
                                 }
                                $('#my-add-participant-table').DataTable().ajax.reload(); 
                            },
                            error: function(data) {
                                console.log(data)
                            }
                        });
                    }
                catch(err) {
                    console.log(err)
                    }
                } else {
            console.log(jQuery('#eemailerr'))
				jQuery('#eemailerr').text('Please enter a valid email address');
			}
        }
})
        $('body').on('click', '.edit_value', function(){
        var a = $(this).closest('tr').find('td:eq(1)').text();
        var b = $(this).closest('tr').find('td:eq(2)').text();
        var c = $(this).closest('tr').find('td:eq(3)').text();
        var d = $(this).closest('tr').find('td:eq(4)').text();
        id = $(this).closest('tr').attr("id")
        jQuery('#eemailerr').text('');
        if(!id){
            id = $(this).attr('data-id')
        }        
        var e = $.trim(a);       
        $('#participant_id').val(id);
        $('#edit-part #efname').val(e);
        $('#edit-part #elname').val(b);
        $('#edit-part #eemail').val(c);
        $('#erelationship').children('option').each((key, item) => {
            var isSelected = ($(item).html() == $.trim(d))? true: false;
            if(isSelected)
                $(item).attr('selected', 'selected');
        });

    });

  $('body').on('click', '.dropdown_area', function(){
    $(this).toggleClass('active_btns');
});
</script>

<!--script for saving data-->
<script type="text/javascript">
      $(document).ready(function() {      

        $('.open-popup-addparticipant').click(function(){	
                    t2 = $('#myTable2').DataTable(
                        {
                        "bDestroy": true,
                        searching: false,
                        "bLengthChange" : false, 
                        responsive: true,
                         "ordering": false,
                         serverSide: true,
                         ajax: window.location.origin + "/participantdt/"+ code ,
                         rowId: "id",
                         columns: [
                         { 
                             "data": "id", 
                             render: function(data, type, full, meta) {
                                 return meta.row + meta.settings._iDisplayStart + 1;
                             }
                         },
                         { "data": "first_name" },
                         { "data": "last_name"},
                         { "data": "email" },
                         { "data": "relationship"},                        
                         ],
                        }
                    );            
                    setTimeout(() => {
                    t2.columns.adjust().responsive.recalc();
                    },1000)
            });
        });

   $('body').on('change', '#relationship1', function() {
        $('#relationshiperr1').text('');
    });

    $('body').on('click', '#email1', function() {
        $('#emailerr1').text('');
    });

    $('body').on('click', '#lname1', function() {
        $('#lnameerr1').text('');
    });

    $('body').on('click', '#fname1', function() {
        $('#fnameerr1').text('');
    });

</script>
</body>
</html>